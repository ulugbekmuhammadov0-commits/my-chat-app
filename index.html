<!DOCTYPE html>
<html>
<head>
    <title>–ü—Ä–æ—Å—Ç–æ–π –ß–∞—Ç</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font: 13px Helvetica, Arial; }
        #form { background: #000; padding: 3px; position: fixed; bottom: 0; width: 100%; display: flex; }
        #input { border: none; padding: 10px; width: 90%; margin-right: .5%; }
        #form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
        #messages { list-style-type: none; margin: 0; padding: 10px 0 60px 0; /* –î–æ–±–∞–≤–ª–µ–Ω –æ—Ç—Å—Ç—É–ø —Å–Ω–∏–∑—É */ }
        
        /* ----------------------------------------------------- */
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ü–£–ó–´–†–¨–ö–û–í –ß–ê–¢–ê */
        /* ----------------------------------------------------- */
        /* ----------------------------------------------------- */
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ü–£–ó–´–†–¨–ö–û–í –ß–ê–¢–ê */
        /* ----------------------------------------------------- */
        /* ----------------------------------------------------- */
        /* –ù–û–í–´–ï –°–¢–ò–õ–ò –î–õ–Ø –ü–£–ó–´–†–¨–ö–û–í –ß–ê–¢–ê */
        /* ----------------------------------------------------- */
        #messages li {
            padding: 8px 12px;
            margin-bottom: 8px;
            max-width: 70%; /* –û–±—â–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ */
            border-radius: 15px;
            word-wrap: break-word;
            clear: both; /* –û—á–∏—Å—Ç–∫–∞ –Ω—É–∂–Ω–∞ –≤—Å–µ–º */
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–ª–µ–≤–∞) */
        #messages li:not(.my-message) { /* üí° –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –°—Ç–∏–ª–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –ù–ï –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è */
            background: #eee;
            color: #000;
            float: left;
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (—Å–ø—Ä–∞–≤–∞) */
        #messages li.my-message {
            background: #DCF8C6; /* –°–≤–µ—Ç–ª–æ-–∑–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω */
            color: #000;
            float: right; /* –¢–µ–ø–µ—Ä—å float: right —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ */
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
        #messages li em {
            display: block;
            text-align: center;
            width: 100%;
            margin: 0;
            padding: 0;
            float: none;
            background: none;
            font-size: 11px;
            color: #777;
        }

        /* –õ–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è */
        #nickname-area {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 10;
            padding: 20px;
        }
        #nickname-area input, #nickname-area button {
            padding: 15px;
            font-size: 18px;
            margin-top: 10px;
            width: 300px;
        }
        /* –°–∫—Ä—ã—Ç—å —á–∞—Ç, –ø–æ–∫–∞ –∏–º—è –Ω–µ –≤–≤–µ–¥–µ–Ω–æ */
        #messages, #form {
            display: none;
        }
    </style>
</head>
<body>
    <div id="nickname-area">
        <input id="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" />
        <button id="set-nickname">–í–æ–π—Ç–∏ –≤ —á–∞—Ç</button>
    </div>
    <ul id="messages"></ul>
    <form id="form" action="">
        <input id="input" autocomplete="off" /><button>–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ª–æ–≥–∏–∫–∏ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const nicknameArea = document.getElementById('nickname-area');
        const nicknameInput = document.getElementById('nickname');
        const setNicknameButton = document.getElementById('set-nickname');
        let username = '–ê–Ω–æ–Ω–∏–º'; 

        // -------------------------------------------------------------------
        // –§–£–ù–ö–¶–ò–Ø: –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function displayMessage(msg) {
            const item = document.createElement('li');
            
            // –ü–†–û–í–ï–†–ö–ê: –ï—Å–ª–∏ –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –≤–∞—à–∏–º –ª–æ–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
            if (msg.username === username) {
                item.classList.add('my-message'); // <--- –î–û–ë–ê–í–õ–Ø–ï–ú –ö–õ–ê–°–°
            }
            
            // –ï—Å–ª–∏ —ç—Ç–æ —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ —Å —Å–µ—Ä–≤–µ—Ä–∞)
            if (msg.username === '–°–∏—Å—Ç–µ–º–∞') {
                item.innerHTML = `<em>${msg.text}</em>`;
                item.style.fontWeight = 'bold';
                item.style.width = '100%'; // –ß—Ç–æ–±—ã —Å–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±—ã–ª–∏ –Ω–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É
                item.style.float = 'none';
                item.style.background = 'none';
                item.style.textAlign = 'center';
            } else {
                // –ï—Å–ª–∏ —ç—Ç–æ –æ–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                item.textContent = `${msg.username}: ${msg.text}`;
            }
            
            messages.appendChild(item);
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            window.scrollTo(0, document.body.scrollHeight);
        }
        // -------------------------------------------------------------------

        // 1. –õ–æ–≥–∏–∫–∞ –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏
        setNicknameButton.addEventListener('click', function() {
            if (nicknameInput.value.trim()) {
                username = nicknameInput.value.trim();
                
                // –°–∫—Ä—ã—Ç—å –æ–±–ª–∞—Å—Ç—å –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –∏ –ø–æ–∫–∞–∑–∞—Ç—å —á–∞—Ç
                nicknameArea.style.display = 'none';
                messages.style.display = 'block';
                form.style.display = 'flex'; // –ò—Å–ø–æ–ª—å–∑—É–µ–º flex –¥–ª—è —Ñ–æ—Ä–º—ã
                
                // –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–º—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                socket.emit('new user', username); 
                
                if (input) {
                    input.placeholder = `–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ ${username}...`;
                }
            }
        });

        // 2. –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–¢–ü–†–ê–í–ö–ò –°–û–û–ë–©–ï–ù–ò–Ø
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (input.value) {
                const msgText = input.value;
                
                // 1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–π —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
                socket.emit('chat message', msgText); 
                
                // 2. –°–†–ê–ó–£ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
                // –≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤—Å–µ–º, –ö–†–û–ú–ï –Ω–∞—Å.
                displayMessage({ 
                    username: username, // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∏–º—è
                    text: msgText 
                });
                
                input.value = '';
            }
        });

        // 3. –û–ë–†–ê–ë–û–¢–ö–ê –ò–°–¢–û–†–ò–ò: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–æ–±—ä–µ–∫—Ç–æ–≤)
        socket.on('history', function(msgs) {
            msgs.forEach(displayMessage);
        });

        // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ù–û–í–û–ì–û —Å–æ–æ–±—â–µ–Ω–∏—è (–æ–±—ä–µ–∫—Ç–∞)
        socket.on('chat message', function(msg) {
            displayMessage(msg); 
        });

    </script>
</body>
</html>