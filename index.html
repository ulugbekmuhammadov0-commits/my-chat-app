<!DOCTYPE html>
<html>
<head>
    <title>–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –ß–∞—Ç</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* –ë–ê–ó–û–í–´–ï –°–¢–ò–õ–ò */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { 
            background: #E9EAEF; /* –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω –¥–ª—è –≤—Å–µ–≥–æ —ç–∫—Ä–∞–Ω–∞ */
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
        }
        
        /* –ò–ú–ò–¢–ê–¶–ò–Ø –ú–û–ë–ò–õ–¨–ù–û–ì–û –ö–û–ù–¢–ï–ô–ù–ï–†–ê */
        #mobile-container {
            width: 100%;
            max-width: 400px;
            height: 90vh;
            background: #FFFFFF;
            border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden; 
            display: flex;
            flex-direction: column;
        }

        /* ----------------------------------------------------- */
        /* –û–ë–õ–ê–°–¢–¨ –°–û–û–ë–©–ï–ù–ò–ô */
        /* ----------------------------------------------------- */
        #messages-wrapper {
            flex-grow: 1;
            overflow-y: auto; 
            padding: 20px 20px 0; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
        }

        #messages { 
            list-style-type: none; 
            padding: 0; 
            /* –û—Ç—Å—Ç—É–ø, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –±—ã–ª–æ –≤–∏–¥–Ω–æ –Ω–∞–¥ —Ñ–æ—Ä–º–æ–π */
            padding-bottom: 70px; 
        }
        
        #messages li {
            padding: 10px 15px;
            margin-bottom: 10px;
            max-width: 85%;
            border-radius: 20px; /* –ë–æ–ª–µ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã–µ */
            word-wrap: break-word;
            clear: both; 
            font-size: 14px;
        }
        
        /* –°–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Å–ª–µ–≤–∞) */
        #messages li:not(.my-message) { 
            background: #F0F2F5; 
            color: #1C1C1C;
            float: left;
            border-top-left-radius: 4px; 
        }

        /* –°–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è (—Å–ø—Ä–∞–≤–∞) */
        #messages li.my-message {
            background: #4A90E2; /* –ì–æ–ª—É–±–æ–π –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç */
            color: #FFFFFF;
            float: right; 
            border-top-right-radius: 4px; 
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
        #messages li em {
            display: block;
            text-align: center;
            font-size: 11px;
            color: #777;
            font-style: normal;
        }

        /* ----------------------------------------------------- */
        /* üí° –§–û–†–ú–ê –û–¢–ü–†–ê–í–ö–ò (–ù–ò–ñ–ù–ò–ô –ë–ê–†) */
        /* ----------------------------------------------------- */
        #form { 
            background: #FFFFFF; 
            padding: 10px 20px; 
            position: absolute; 
            bottom: 0; 
            width: 100%; 
            display: flex;
            align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
            border-top: 1px solid #F0F2F5;
        }
        #input { 
            border: none; 
            padding: 12px 18px; /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –ø–∞–¥–¥–∏–Ω–≥ */
            width: 100%; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É—é —à–∏—Ä–∏–Ω—É */
            background: #F0F2F5; 
            border-radius: 25px; 
            margin-right: 10px;
            outline: none;
            font-size: 15px;
        }
        #form button { 
            width: 45px; /* –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä */
            height: 45px;
            background: #4A90E2; 
            border: none; 
            border-radius: 50%;
            color: white;
            font-size: 20px; /* –ë–æ–ª—å—à–µ –∏–∫–æ–Ω–∫–∞ —Å—Ç—Ä–µ–ª–∫–∏ */
            padding-bottom: 3px;
            line-height: 1;
            cursor: pointer;
            flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
        }
        
        /* ----------------------------------------------------- */
        /* üí° –û–ë–õ–ê–°–¢–¨ –í–•–û–î–ê/–†–ï–ì–ò–°–¢–†–ê–¶–ò–ò (NICKNAME-AREA) */
        /* ----------------------------------------------------- */
        #nickname-area {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #F0F2F5; /* –°–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            z-index: 100; 
            padding: 20px;
        }
        #nickname-area h2 {
            font-size: 28px;
            color: #1C1C1C;
            margin-bottom: 30px;
            font-weight: 700;
        }
        #nickname-area input {
            padding: 18px;
            font-size: 16px;
            margin-bottom: 15px;
            width: 80%;
            max-width: 350px;
            border-radius: 12px;
            border: 1px solid #ccc;
            outline: none;
        }
        #nickname-area button {
            padding: 18px;
            font-size: 18px;
            width: 80%;
            max-width: 350px;
            border-radius: 12px;
            border: none;
            background: #4A90E2; /* –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç */
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }
        #nickname-area button:hover {
            background: #3A7CC6;
        }

        /* –°–∫—Ä—ã—Ç—å —á–∞—Ç, –ø–æ–∫–∞ –∏–º—è –Ω–µ –≤–≤–µ–¥–µ–Ω–æ */
        #messages-wrapper, #form {
            display: none;
        }
    </style>
</head>
<body>
    <div id="nickname-area">
        <h2>–í–æ–π—Ç–∏ –≤ –ß–∞—Ç</h2>
        <input id="nickname" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" />
        <button id="set-nickname">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
    </div>

    <div id="mobile-container">
        
        <div id="messages-wrapper">
            <ul id="messages"></ul>
        </div>
        
        <form id="form" action="">
            <input id="input" autocomplete="off" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
            <button>‚ûî</button>
        </form>

    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();

        const form = document.getElementById('form');
        const input = document.getElementById('input');
        const messages = document.getElementById('messages');
        
        const nicknameArea = document.getElementById('nickname-area');
        const nicknameInput = document.getElementById('nickname');
        const setNicknameButton = document.getElementById('set-nickname');
        const messagesWrapper = document.getElementById('messages-wrapper');
        const mobileContainer = document.getElementById('mobile-container'); // –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        
        let username = '–ê–Ω–æ–Ω–∏–º'; 

        // -------------------------------------------------------------------
        // –§–£–ù–ö–¶–ò–Ø: –û—Ç–æ–±—Ä–∞–∑–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function displayMessage(msg) {
            const item = document.createElement('li');
            
            if (msg.username === username) {
                item.classList.add('my-message');
            }
            
            if (msg.username === '–°–∏—Å—Ç–µ–º–∞') {
                item.innerHTML = `<em>${msg.text}</em>`;
                item.style.width = '100%';
                item.style.float = 'none';
                item.style.background = 'none';
                item.style.textAlign = 'center';
                item.style.padding = '5px 0';
            } else {
                item.textContent = `${msg.username}: ${msg.text}`;
            }
            
            messages.appendChild(item);
            // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å–æ–æ–±—â–µ–Ω–∏–π
            messagesWrapper.scrollTop = messagesWrapper.scrollHeight;
        }
        // -------------------------------------------------------------------

        // 1. –õ–û–ì–ò–ö–ê –í–•–û–î–ê
        setNicknameButton.addEventListener('click', function() {
            if (nicknameInput.value.trim()) {
                username = nicknameInput.value.trim();
                
                nicknameArea.style.display = 'none';
                messagesWrapper.style.display = 'block';
                form.style.display = 'flex';
                
                socket.emit('new user', username); 
                
                if (input) {
                    input.placeholder = `–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–∞–∫ ${username}...`;
                }
            }
        });

        // 2. –û–ë–†–ê–ë–û–¢–ß–ò–ö –û–¢–ü–†–ê–í–ö–ò –°–û–û–ë–©–ï–ù–ò–Ø
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            if (input.value) {
                const msgText = input.value;
                
                socket.emit('chat message', msgText); 
                
                displayMessage({ 
                    username: username,
                    text: msgText 
                });
                
                input.value = '';
            }
        });

        // 3. –û–ë–†–ê–ë–û–¢–ö–ê –ò–°–¢–û–†–ò–ò
        socket.on('history', function(msgs) {
            msgs.forEach(displayMessage);
        });

        // 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ù–û–í–û–ì–û —Å–æ–æ–±—â–µ–Ω–∏—è 
        socket.on('chat message', function(msg) {
            displayMessage(msg); 
        });


        // üí° –ù–û–í–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –ú–û–ë–ò–õ–¨–ù–û–ô –ö–õ–ê–í–ò–ê–¢–£–†–´
        
        // –ü—Ä–∏ —Ñ–æ–∫—É—Å–µ: –£–º–µ–Ω—å—à–∞–µ–º –≤—ã—Å–æ—Ç—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π.
        input.addEventListener('focus', function() {
            // –£–º–µ–Ω—å—à–∞–µ–º –≤–∏–¥–∏–º—É—é –≤—ã—Å–æ—Ç—É –º–æ–±–∏–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —Å–¥–≤–∏–Ω—É–ª –µ–≥–æ –≤–≤–µ—Ä—Ö
            mobileContainer.style.height = 'calc(100vh - 60px)'; // 60px - –ø—Ä–∏–º–µ—Ä–Ω—ã–π —Ä–∞–∑–º–µ—Ä –Ω–∏–∂–Ω–µ–≥–æ –æ—Ç—Å—Ç—É–ø–∞
            mobileContainer.style.maxHeight = 'calc(100vh - 60px)';
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
            messagesWrapper.scrollTop = messagesWrapper.scrollHeight;
        });

        // –ü—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞: –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤ –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
        input.addEventListener('blur', function() {
            mobileContainer.style.height = '90vh'; 
            mobileContainer.style.maxHeight = 'none'; 
        });

    </script>
</body>
</html>